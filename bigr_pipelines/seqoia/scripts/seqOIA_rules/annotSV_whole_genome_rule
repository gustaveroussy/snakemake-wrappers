rule annotSV_whole_genome:
	input:
		bed = "{basedir}/{analysis}/Facet/{analysis}_facet_result.bed",
		final_vcf = "{basedir}/{analysis}/{analysis}_final_temp.vcf"
	output:
		tsv = "{basedir}/{analysis}/Facet/annotSV/{analysis}_facet_result.annotated.tsv"
	resources: io=2
	params:
		annotSV_options = config["AnnotSV"]["OPTIONS"],
		database = config["AnnotSV"]["DATABASE"],
		annotSV_version = config["AnnotSV"]["VERSION"],
		sample = config["general_informations"]["WGS-T"]["ID"].split("_S")[0]
	log:
		"{basedir}/{analysis}/log/Facet/{analysis}_annotsv.log"
	run:
		with open(input.bed, "r") as f:
			new_data = []
			for lines in f:
				lines = lines.split('\t')
				if lines[0] == "23":
					lines[0] = "X"
				new_data.append(lines)
		with open(input.bed, "w+") as o:
			for lines in new_data:
				o.write("\t".join(lines))
		cmd = 'singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ -B /mnt/beegfs/pipelines/sandbox_dir/seqoia/singularity/seqoia_cancer-main:/mnt/beegfs/pipelines/sandbox_dir/seqoia/singularity/seqoia_cancer-main /mnt/beegfs/software/seqoia/singularity/annotsv_2.5.1-2.sif bash -c "AnnotSV {params.annotSV_options} -SVinputFile {input.bed} -outputFile {output.tsv} -annotationsDir {params.database}/{params.annotSV_version}/ -snvIndelFiles {input.final_vcf} -snvIndelSamples {params.sample} -candidateSnvIndelFiles {input.final_vcf} -candidateSnvIndelSamples {params.sample} 2>&1 | tee -a {log}"'
		shell(cmd)
