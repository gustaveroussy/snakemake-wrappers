rule gatk_mutect2_wgs:
	input:
		bam_T = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_bqsr.bam", index=wildcards.index, prefix=wgs_tumor, basedir=basedir, analysis=wildcards.analysis),
		bai_T = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_bqsr.bai", index=wildcards.index, prefix=wgs_tumor, basedir=basedir, analysis=wildcards.analysis),
		bam_C = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_bqsr.bam", index=wildcards.index, prefix=wgs_constit, basedir=basedir, analysis=wildcards.analysis),
                bai_C = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_bqsr.bai", index=wildcards.index, prefix=wgs_constit, basedir=basedir, analysis=wildcards.analysis)
	output:
		vcf = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_wgs_mutect2.vcf",
		idx = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_wgs_mutect2.vcf.idx"
	resources: io=1
	log:
		"{basedir}/{analysis}/log/{prefix}/chr_{index}/{prefix}_chr_{index}_mutect2_wes.log"
	params:
		reference = config["general_informations"]["FASTA_FILE"],
		mutect2_options = config["gatk_mutect2_wgs"]["OPTIONS"],
		constit = config["general_informations"]["WGS_CONSTIT"]["ID"]
	shell:
		'java -Xmx9000m -Xms9000m -XX:ParallelGCThreads=3 -XX:+AggressiveHeap -jar /usr/share/java/gatk-package-4.1.4.1-local.jar Mutect2 {params.mutect2_options} -I {input.bam_T} -I {input.bam_C} -normal {params.constit} -L {wildcards.index} -O {output.vcf} -R {params.reference} 2>&1 | tee -a {log}'
