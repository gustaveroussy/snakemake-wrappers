rule msisensor:
	input:
		bam_tumor = lambda wildcards : expand("{basedir}/{analysis}/{prefix}/{prefix}_facet_merged.bam",  basedir=basedir, analysis=wildcards.analysis, prefix=wgs_tumor),
		bai_tumor = lambda wildcards : expand("{basedir}/{analysis}/{prefix}/{prefix}_facet_merged.bam.bai",  basedir=basedir, analysis=wildcards.analysis, prefix=wgs_tumor),
		bam_constit = lambda wildcards : expand("{basedir}/{analysis}/{prefix}/{prefix}_facet_merged.bam",  basedir=basedir, analysis=wildcards.analysis, prefix=wgs_constit),
		bai_constit = lambda wildcards : expand("{basedir}/{analysis}/{prefix}/{prefix}_facet_merged.bam.bai",  basedir=basedir, analysis=wildcards.analysis, prefix=wgs_constit)
	output:
		temp("{basedir}/{analysis}/{prefix}/Msisensor.txt")
	log:
		"{basedir}/{analysis}/log/{prefix}/msisensor.log"
	params:
		msisensor_options = config["msisensor"]["OPTIONS"],
		reference = config["general_informations"]["FASTA_FILE"],
		microstat = config["msisensor"]["MICROSATELLITES_LIST"],
	shell:
		"""
		singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ /mnt/beegfs/software/seqoia/singularity/msisensor2_20191121-1.sif bash -c "msisensor2 msi -d {params.microstat} -n {input.bam_constit} -t {input.bam_tumor} -o {output} {params.msisensor_options} 2>&1 | tee -a {log}"
		"""
