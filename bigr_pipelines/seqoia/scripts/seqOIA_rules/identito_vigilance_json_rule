rule identito_vigilance_json:
	input:
		identito = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/{prefix}_identito_temp.csv",basedir=basedir, analysis=wildcards.analysis, prefix=wildcards.prefix),
		script_python = lambda wildcards: expand("{script_dir}/identito-vigilance-json.py",script_dir=script_dir),
		sample_sheet = lambda wildcards: expand("{input_dir}/sample_sheet/{run}.csv",input_dir=input_dir, run=config["general_informations"][str(wildcards.prefix.split("_")[1])]["RUN"])
	output:
		"{export_dir}/{analysis}/{prefix}_identito.json"
	log:
		basedir + "/{analysis}/log/{prefix}/{prefix}_identito.json"
	params:
		pid_crc = config["general_informations"]["PID_CRC"],
		date  = config["general_informations"]["BIOINFO_ANALYSIS_DATE"],
		run = lambda wildcards:  config["general_informations"][str(wildcards.prefix.split("_")[1])]["RUN"],
	shell:
		"""
		singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ -B /mnt/beegfs/database/bioinfo/seqoia/original/annotations:/data/annotations /mnt/beegfs/software/seqoia/singularity/python3-numpy_1.16.2-1.sif bash -c "python3 {input.script_python} -c {input.sample_sheet} -i {input.identito} -a {wildcards.analysis} -p {params.pid_crc} -d {params.date} -id {wildcards.prefix} -r {params.run} -o {output} 2>&1 | tee -a {log}"
		"""