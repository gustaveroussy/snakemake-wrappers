rule picard_collect_wgs_metrics:
	input:
		bam = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_markdup.temp.bam",
		bai = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_markdup.temp.bam.bai"
	output:
		"{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_collect_wgs_metrics.txt"
	resources: io=2
	log:
		"{basedir}/{analysis}/log/{prefix}/chr_{index}/{prefix}_chr_{index}_collect_wgs_metrics.log"
	params:
		picard_collect_wgs_metrics_options = config["picard_collect_wgs_metrics"]["OPTIONS"],
		reference = config["general_informations"]["FASTA_FILE"],
		genome = config["picard_collect_wgs_metrics"]["GENOME"]
	shell:
		"java -Xmx7500m -Xms7500m -XX:ParallelGCThreads=1 -XX:+AggressiveHeap -jar /usr/share/java/GenomeAnalysisTK.jar CollectWgsMetrics {params.picard_collect_wgs_metrics_options} -I {input.bam} -O {output} -R {params.reference} --INTERVALS /data/annotations/annotations_to_sort/picard/{params.genome}_alegendre/intervalist_chr_{wildcards.index}.list 2>&1 | tee -a {log}"

