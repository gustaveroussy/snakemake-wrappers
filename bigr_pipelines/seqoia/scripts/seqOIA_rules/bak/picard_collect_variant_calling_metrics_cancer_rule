rule picard_collect_variant_calling_metrics_cancer:
	input:
		vcf = "{basedir}/{analysis}/chr_{index}/{analysis}_chr_{index}_snpsift_phastcons.vcf",
		idx = "{basedir}/{analysis}/chr_{index}/{analysis}_chr_{index}_snpsift_phastcons.vcf.idx"
	output:
		counts = "{basedir}/{analysis}/chr_{index}/{analysis}_chr_{index}_variant.variant_calling_summary_metrics",
		proportions = "{basedir}/{analysis}/chr_{index}/{analysis}_chr_{index}_variant.variant_calling_detail_metrics"
	resources: io=2
	log:
		"{basedir}/{analysis}/chr_{index}/{analysis}_chr_{index}_collect_variant_calling_metrics.log"
	params:
		picard_collect_variant_calling_metrics_options = config["picard_collect_variant_calling_metrics"]["OPTIONS"],
		database=config["picard_collect_variant_calling_metrics"]["DATABASE"],
		genome = config["picard_collect_variant_calling_metrics"]["GENOME"]
	run:
		chr_file = "{}".format(input.vcf)
                if os.stat(chr_file).st_size==0:
                        cmd = "set -o pipefail; touch {output.counts} && touch {output.proportions}"
                        shell(cmd)
		else:
			shell("java -Xmx8000m -Xms8000m -XX:ParallelGCThreads=2 -XX:+AggressiveHeap -jar /usr/share/java/GenomeAnalysisTK.jar CollectVariantCallingMetrics {params.picard_collect_variant_calling_metrics_options} -I {input.vcf} -O {wildcards.basedir}/{wildcards.analysis}/chr_{wildcards.index}/{wildcards.analysis}_chr_{wildcards.index}_variant --DBSNP {params.database} -TI /data/annotations/annotations_to_sort/picard/{params.genome}/intervalist_chr_{wildcards.index}.list 2>&1 | tee -a {log}")

