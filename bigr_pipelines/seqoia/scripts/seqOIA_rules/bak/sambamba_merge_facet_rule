rule sambamba_merge_facet:
	input:
		flag = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_bqsr.bam", basedir=basedir, analysis=wildcards.analysis, prefix=wildcards.prefix, index=facet)
	output:
		temp("{basedir}/{analysis}/{prefix}/{prefix}_facet_merged.bam")
	resources: io=3
	log:
		"{basedir}/{analysis}/log/{prefix}/{prefix}_sambamba_merge_facet.log"
	params:
		sambamba_merge_options = config["sambamba_merge_facet"]["OPTIONS"]
	shell:
		"sambamba merge {params.sambamba_merge_options} {output} {input} 2>&1 | tee -a {log}"
