rule sambamba_merge_facet:
	input:
		flag = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_bqsr.bam", basedir=basedir, analysis=wildcards.analysis, prefix=wildcards.prefix, index=facet)
	output:
		temp("{basedir}/{analysis}/{prefix}/{prefix}_facet_merged.bam")
	resources: io=3
	log:
		"{basedir}/{analysis}/log/{prefix}/{prefix}_sambamba_merge_facet.log"
	params:
		sambamba_merge_options = config["sambamba_merge_facet"]["OPTIONS"]
	shell:
		"""
		singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ /mnt/beegfs/software/seqoia/singularity/sambamba_0.7.1-static.sif bash -c "sambamba merge {params.sambamba_merge_options} {output} {input} 2>&1 | tee -a {log}"
		"""
