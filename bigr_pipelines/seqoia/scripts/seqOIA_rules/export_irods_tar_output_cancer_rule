rule export_irods_tar_output_cancer:
	input:
		annotSV = lambda wildcards: expand("{basedir}/{analysis}/Facet/annotSV/{analysis}_facet_result.annotated.final.tsv",basedir=basedir, analysis=wildcards.analysis),
		annot_SV_chr = lambda wildcards: expand("{basedir}/{analysis}/Facet/chr_{index}/{analysis}_chr_{index}_facet_result.annotated.final.tsv",  basedir=basedir, analysis=wildcards.analysis, index=facet),
		annotSV_wisecondor = lambda wildcards: expand("{basedir}/{analysis}/Wisecondor/{analysis}_wisecondor.annotated.final.tsv",basedir=basedir, analysis=wildcards.analysis),
		bed_annotSV_wisecondor = lambda wildcards: expand("{basedir}/{analysis}/Wisecondor/{analysis}_wisecondor_aberrations.bed",basedir=basedir, analysis=wildcards.analysis),
		plot_wisecondor = lambda wildcards: expand("{basedir}/{analysis}/Wisecondor/{analysis}_wisecondor.plots/",basedir=basedir, analysis=wildcards.analysis),
		pdf_facet_genome = lambda wildcards: expand("{basedir}/{analysis}/Facet/{analysis}_facet_Rplots.pdf",basedir=basedir, analysis=wildcards.analysis),
		bed_facet_genome = lambda wildcards: expand("{basedir}/{analysis}/Facet/{analysis}_facet_result.bed",basedir=basedir, analysis=wildcards.analysis),
		pdf_facet = lambda wildcards: expand("{basedir}/{analysis}/Facet/chr_{index}/{analysis}_chr_{index}_facet_Rplots.pdf", basedir=basedir, analysis=wildcards.analysis, index=facet),
		bed_facet = lambda wildcards: expand("{basedir}/{analysis}/Facet/chr_{index}/{analysis}_chr_{index}_facet_result.bed",  basedir=basedir, analysis=wildcards.analysis, index=facet),
		fusion_annotator = lambda wildcards: expand("{basedir}/{analysis}/{sample}/star_fusion/fusion_inspector/annotator/{sample}.star-fusion-annotator.annotated_list.txt",basedir=basedir, analysis=analysis, sample=wts),
		arriba_drawing = lambda wildcards: expand("{basedir}/{analysis}/{sample}/Arriba/{sample}_arriba_fusion.pdf",  basedir=basedir, analysis=wildcards.analysis, sample=wts),
		tmb = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/charge_mut/TMB_result.txt", basedir=basedir, analysis = wildcards.analysis, prefix = wes_tumor),
		msisensor = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/Msisensor.txt",  basedir=basedir, analysis=wildcards.analysis, prefix=vcf_id),
		plot_SBS96 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/output/plots/SBS_96_plots_test_exome.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		plot_ID83 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/output/plots/ID_83_plots_test_exome.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		plot_DBS78 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/output/plots/DBS_78_plots_test_exome.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		decomp_DBS78 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/Res/Deconvolution_DBS78_Decomposed/Signature_plotDBS_78_plots_Deconvolution_DBS78_Decomposed.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		act_DBS78 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/Res/Deconvolution_DBS78_Decomposed/Deconvolution_DBS78_Decomposed_Activities_Plot_SBS78.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		decomp_ID83 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/Res/Deconvolution_ID83_Decomposed/Signature_plotID_83_plots_Deconvolution_ID83_Decomposed.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		act_ID83 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/Res/Deconvolution_ID83_Decomposed/Deconvolution_ID83_Decomposed_Activities_Plot_SBS83.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		decomp_SB96 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/Res/Deconvolution_SB96_Decomposed/Signature_plotSBS_96_plots_Deconvolution_SB96_Decomposed.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor),
		act_SB96 = lambda wildcards: expand("{basedir}/{analysis}/{prefix}/sign_mut/Res/Deconvolution_SB96_Decomposed/Deconvolution_SB96_Decomposed_Activities_Plot_SBS96.pdf",  basedir=basedir, analysis=wildcards.analysis, prefix=wes_tumor)
	output:
		flag = "{export_dir}/{analysis}/export_data_tar.done",
		act_DBS78 = "{export_dir}/{analysis}/Signature_mutationelle/Signatures/Deconvolution_DBS78_Decomposed_Activities_Plot_SBS78.pdf",
		decomp_DBS78 = "{export_dir}/{analysis}/Signature_mutationelle/Signatures/Signature_plotDBS_78_plots_Deconvolution_DBS78_Decomposed.pdf",
		decomp_ID83 = "{export_dir}/{analysis}/Signature_mutationelle/Signatures/Signature_plotID_83_plots_Deconvolution_ID83_Decomposed.pdf",
		decomp_SBS96 = "{export_dir}/{analysis}/Signature_mutationelle/Signatures/Signature_plotSBS_96_plots_Deconvolution_SB96_Decomposed.pdf",
		act_ID83 = "{export_dir}/{analysis}/Signature_mutationelle/Signatures/Deconvolution_ID83_Decomposed_Activities_Plot_SBS83.pdf",
		act_SBS96 = "{export_dir}/{analysis}/Signature_mutationelle/Signatures/Deconvolution_SB96_Decomposed_Activities_Plot_SBS96.pdf",
		CNV = "{export_dir}/{analysis}/CNV",
		charge_mut = "{export_dir}/{analysis}/Charge_mutationnelle",
		fusions = "{export_dir}/{analysis}/Fusions",
		insta_micro = "{export_dir}/{analysis}/Instabilite_microsatellite",
		sign_mut = "{export_dir}/{analysis}/Signature_mutationelle"
	log:
		basedir+"/{analysis}/log/output_tar/{analysis}_export_data_tar.log"
	shell:
		"mkdir -p {wildcards.export_dir}/{wildcards.analysis}/CNV/Facet/Chr/ {wildcards.export_dir}/{wildcards.analysis}/CNV/Facet/Genome/ {wildcards.export_dir}/{wildcards.analysis}/CNV/Wisecondor/Plots_by_chr/ {wildcards.export_dir}/{wildcards.analysis}/Signature_mutationelle/Signatures/ {wildcards.export_dir}/{wildcards.analysis}/Signature_mutationelle/Profil_mutationnel/ && rsync -Paz {input.tmb} {wildcards.export_dir}/{wildcards.analysis}/Charge_mutationnelle/ && rsync -Paz {input.pdf_facet} {input.bed_facet} {input.annot_SV_chr} {wildcards.export_dir}/{wildcards.analysis}/CNV/Facet/Chr/ && rsync -Paz {input.bed_facet_genome} {input.pdf_facet_genome} {input.annotSV} {wildcards.export_dir}/{wildcards.analysis}/CNV/Facet/Genome/ && rsync -Paz {input.bed_annotSV_wisecondor} {input.annotSV_wisecondor} {wildcards.export_dir}/{wildcards.analysis}/CNV/Wisecondor/ && rsync -Paz {input.plot_wisecondor} {wildcards.export_dir}/{wildcards.analysis}/CNV/Wisecondor/Plots_by_chr/ && rsync -Paz {input.fusion_annotator} {input.arriba_drawing} {wildcards.export_dir}/{wildcards.analysis}/Fusions/  && rsync -Paz {input.msisensor} {wildcards.export_dir}/{wildcards.analysis}/Instabilite_microsatellite/ && rsync -Paz {input.decomp_DBS78} {input.act_DBS78} {input.decomp_ID83} {input.act_ID83} {input.decomp_SB96} {input.act_SB96} {wildcards.export_dir}/{wildcards.analysis}/Signature_mutationelle/Signatures/ && rsync -Paz {input.plot_SBS96} {input.plot_ID83} {input.plot_DBS78} {wildcards.export_dir}/{wildcards.analysis}/Signature_mutationelle/Profil_mutationnel/ && touch {output.flag} 2>&1 | tee -a {log}"
