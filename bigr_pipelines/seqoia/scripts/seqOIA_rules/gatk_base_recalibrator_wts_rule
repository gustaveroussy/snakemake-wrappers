rule gatk_base_recalibrator_wts:
	input:
		"{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_wts_markdup.temp.bam"
	output:
		temp("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_wts_recalibration.table")
	resources: io=2
        priority: 46
	log:
		"{basedir}/{analysis}/log/{prefix}/chr_{index}/{prefix}_chr_{index}_wts_gatk_base_recalibrator.log"
	params:
		gatk_base_recalibrator_options = config["gatk_base_recalibrator"]["OPTIONS"],
		reference = config["general_informations"]["FASTA_FILE"],
		known_indels = config["general_informations"]["KNOWN_INDELS"],
		known_snps = config["general_informations"]["KNOWN_SNPS"]
	shell:
		"""
		singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ /mnt/beegfs/software/seqoia/singularity/gatk_4.1.0.0-1.sif bash -c "java -Xmx11500m -Xms11500m -XX:ParallelGCThreads=2 -XX:+AggressiveHeap -jar /usr/share/java/gatk-package-4.1.0.0-local.jar BaseRecalibrator {params.gatk_base_recalibrator_options} -R {params.reference} --known-sites {params.known_snps} --known-sites {params.known_indels} -I {input} -O {output} 2>&1 | tee -a {log}"
		"""
