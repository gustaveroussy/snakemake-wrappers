rule bcftools_concat_wgs:
	input:
		#lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_reheader.vcf", basedir=basedir, analysis = wildcards.analysis, prefix=wildcards.prefix, index=index)
		lambda wildcards: expand("{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_snpsift_phastcons.vcf", basedir=basedir, analysis = wildcards.analysis, prefix=wildcards.prefix, index=index)
	output:
		"{basedir}/{analysis}/{prefix}/{prefix}_final.vcf"
	resources: io=30
	log:
		"{basedir}/{analysis}/log/{prefix}/{prefix}_final_bcftools_concat.log"
	run:	
		l = []
		for k in input:
			if os.stat(str(k)).st_size !=0:
				l.append(str(k))
		input_files = str(l).replace("[","").replace("]","").replace(",","").replace("'","")
		cmd = 'singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ /mnt/beegfs/software/seqoia/singularity/bcftools_1.9-1.sif bash -c "bcftools concat -o {output} {input_files} 2>&1 | tee -a {log}"'
		shell(cmd)
