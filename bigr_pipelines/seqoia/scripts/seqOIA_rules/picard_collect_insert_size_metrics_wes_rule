rule picard_collect_insert_size_metrics_wes:
	input:
		bam = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_markdup.temp.bam",
		bai = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_markdup.temp.bam.bai"
	output:
		txt = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_size_metrics_wes.txt",
		pdf = "{basedir}/{analysis}/{prefix}/chr_{index}/{prefix}_chr_{index}_size_metrics_wes.pdf",
	resources: io=10
	log:
		"{basedir}/{analysis}/log/{prefix}/chr_{index}/{prefix}_chr_{index}_picard_collect_insert_size_metrics_wes.log"
	params:
		picard_collect_insert_size_metrics_options = config["picard_collect_insert_size_metrics"]["OPTIONS"],
		reference = config["general_informations"]["FASTA_FILE"]
	shell:
		"""
		singularity exec -B /mnt/beegfs/database/bioinfo/seqoia:/mnt/beegfs/database/bioinfo/seqoia -B /mnt/beegfs/scratch/:/mnt/beegfs/scratch/ /mnt/beegfs/software/seqoia/singularity/gatk_4.1.7.0-1.sif bash -c "java -Xmx3500m -Xms3500m -XX:ParallelGCThreads=3 -XX:+AggressiveHeap -jar /usr/share/java/GenomeAnalysisTK.jar CollectInsertSizeMetrics {params.picard_collect_insert_size_metrics_options} -I {input.bam} -R {params.reference} -O {output} -H {output.pdf} -L /data/annotations/Human/GRCh38/DB/custom/Twist_Bioscience/Merge_CORE-SPIKE_GRCh38.{wildcards.index}.merged.bed 2>&1 | tee -a {log}"
		"""
